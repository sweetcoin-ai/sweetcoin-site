<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Claim Sweetcoin</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
  <style>
    body { font-family: sans-serif; }
    .container {
      max-width: 800px;
      margin: 80px auto;
      padding: 20px;
      font-size: 18px;
      line-height: 1.8;
      text-align: center;
    }
    .btn {
      background-color: #facc15;
      color: #000;
      padding: 12px 28px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      text-decoration: none;
    }
    .fade-out {
      opacity: 0;
      transition: opacity 1s ease;
    }
    .hidden { display: none; }
    footer {
      margin-top: 60px;
      padding: 20px;
      background: #f4f4f4;
      text-align: center;
    }
  </style>
</head>
<body>
<header>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="whitepaper.html">Whitepaper</a></li>
      <li><a href="claim.html">Claim</a></li>
    </ul>
  </nav>
</header>

<section class="container" id="introSection">
  <h1>Claim Sweetcoin (SWTC)</h1>
  <p>Why choose Sweetcoin?</p>
  <ul>
    <li>üíé A decentralized stablecoin governed by AI ‚Äî no banks or governments.</li>
    <li>üç¶ Pegged to the global average price of an ice cream cone ‚Äî fair and intuitive.</li>
    <li>üß† AI and public consensus ensure transparency ‚Äî no central control, no hidden rules.</li>
    <li>üöÄ Real-world payments with QR support and fast transactions via BSC.</li>
    <li>üåç Designed to become a universal unit of value in decentralized commerce.</li>
  </ul>
  <p>
    Be among the first holders. Get 20 free SWTC now and join the financial future.
  </p>
  <div>
    <button id="connectBtn" class="btn" onclick="revealClaim()">I understand, continue</button>
  </div>
</section>

<section class="container hidden" id="claimSection">
  <h2>Claim Your Tokens</h2>
  <p>Click the button below to connect your wallet and claim <strong>20 SWTC</strong>.</p>
  <button id="actionButton" class="btn">Connect Wallet</button>
  <p id="statusMessage"></p>
</section>

<footer>
  <p>&copy; 2025 Sweetcoin. All rights reserved.</p>
</footer>

<script>
  const CONTRACT_ADDRESS = "0x005A04acdC294f20f7Ab60fd51525299838393B3";
  const CONTRACT_ABI = ["function claim() external"];
  let provider, signer, contract;
  let walletConnected = false;
  let claimed = false;
  let actionLocked = false;

  function revealClaim() {
    const intro = document.getElementById("introSection");
    intro.classList.add("fade-out");
    setTimeout(() => {
      intro.classList.add("hidden");
      document.getElementById("claimSection").classList.remove("hidden");
    }, 1000);
  }

  async function handleAction() {
    const button = document.getElementById("actionButton");
    const status = document.getElementById("statusMessage");

    if (actionLocked) return;
    actionLocked = true;
    button.disabled = true;

    try {
      if (!walletConnected) {
        status.textContent = "Waiting for wallet...";
        await window.ethereum.request({ method: "eth_requestAccounts" });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
        const userAddress = await signer.getAddress();
        status.textContent = "Connected: " + userAddress;
        walletConnected = true;
        button.textContent = "Claim 20 SWTC";
        button.disabled = false;
        actionLocked = false;
      } else if (!claimed) {
        const network = await provider.getNetwork();
        if (network.chainId !== 56) {
          status.textContent = "Please switch to BSC Mainnet.";
          button.disabled = false;
          actionLocked = false;
          return;
        }
        status.textContent = "Processing transaction...";
        const tx = await contract.claim();
        await tx.wait();
        status.textContent = "Success! 20 SWTC claimed üéâ";
        claimed = true;
        button.disabled = true;
      }
    } catch (err) {
      const msg = err?.error?.message || err.message || "";
      if (msg.includes("execution reverted") || msg.toLowerCase().includes("already claimed") || msg.includes("JSON-RPC")) {
        status.textContent = "ÊÇ®Â∑≤ÁªèÈ¢ÜÂèñËøá‰∫Ü„ÄÇ";
      } else {
        status.textContent = "Error: " + msg;
      }
      button.disabled = false;
      actionLocked = false;
    }
  }

  document.getElementById("actionButton").addEventListener("click", handleAction);
</script>

</body>
</html>
